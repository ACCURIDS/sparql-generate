# The Protocol

The protocol part of SPARQL-Generate enables a web client or a web server to point to the IRI of a SPARQL-Generate document that may be used to interpret the request (or the response) payload as RDF.

## IANA considerations.

The Internet Media type of a SPARQL-Generate query is `application/sparql-generate`, with file extension `*.rqg`.

## "How you, server, should interpret my lightweight HTTP request payload as a RDF Graph"

This protocol enables HTTP clients to be lightweight, and let servers interpret their requests body as RDF Graphs:

If:

1. client sets:
    1. HTTP Request Header Field `Content-Type` to IRI `ct`;
    1. HTTP Request Header Field `RDF-Query` to IRI `url`;
    1. HTTP Request Header Field `RDF-Variable` to string `var`;
    1. HTTP Request Body `body`;
1. server operates a HTTP GET at IRI `url`, with Accept Field `application/sparql-generate`;
    1. the response header has `Content-Type : application/sparql-generate`;
    1. and the response body is a valid SPARQL-Generate query `query`;
1. RDF Graph `G` is generated by the execution of request `query` with variable `?var` initially bound to RDF literal:
    1. with lexical form `body`;
    1. with datatype URI is the concatenation of `urn:iana:mime:` and `ct`.

Then, the client _believes_ that `G` is an equivalent resource representation of its request.


## "How you, client, should interpret my lightweight HTTP response payload as a RDF Graph"

This protocol enables HTTP servers to be lightweight, and let clients interpret their response body as RDF Graphs:

If:

1. server sets:
    1. HTTP Request Header Field `Link` (a web-link) with:
        1. context is the originally requested IRI;
        1. link relation is [http://w3id.org/sparql-generate/voc#query](http://w3id.org/sparql-generate/voc#query);
        1. target IRI is `url`;
        1. target attribute `var` is set to `v`;
    1. HTTP Response Header Field `Content-Type` to IRI `ct`;
    1. HTTP Response Body `body`;
1. client operates a HTTP GET at IRI `url`, with Accept Field `application/sparql-generate`;
    1. the response header has `Content-Type : application/sparql-generate`;
    1. and the response body is a valid SPARQL-Generate query `query`;
1. RDF Graph `G` is generated by the execution of request `query` with variable `v` being initially bound to RDF literal:
    1. with lexical form `body`;
    1. with datatype URI is the concatenation of `urn:iana:mime:` and `ct`.

Then, the server _believes_ that `G` is an equivalent resource representation of its response.

Below is an example of such a web-link:

```
Link: <http://manufacturer.com/deviceX/sparql-gen>; rel="http://w3id.org/sparql-generate/voc#query"; var="message"
```

