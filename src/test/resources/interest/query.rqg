PREFIX  xsd:  <http://www.w3.org/2001/XMLSchema#>
PREFIX  rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX  foaf: <http://xmlns.com/foaf/0.1/>

PREFIX rqg-sel: <http://w3id.org/sparql-generate/sel/>
PREFIX rqg-fn: <http://w3id.org/sparql-generate/fn/>

GENERATE 
  { ?p  rdf:type        foaf:Person ;
        foaf:firstName  ?first ;
        foaf:lastName   ?last ;
        foaf:birthday  ?birthday .

      GENERATE 
        { ?p  foaf:interest ?page . }
      WHERE
        { BIND(rqg-fn:JSONPath(?msg, "$") AS ?interest)
          BIND(uri(concat("http://dbpedia.org/page/", ?interest)) AS ?page)
        }
      SELECTOR rqg-sel:JSONPath(?msg, "$.interests[*]") AS ?msg .

  }
WHERE
  { BIND(rqg-fn:JSONPath(?msg, "$.firstname") AS ?first)
    BIND(rqg-fn:JSONPath(?msg, "$.lastname") AS ?last)
    BIND(rqg-fn:JSONPath(?msg, "$.birthday") AS ?birthday)
    BIND(rqg-fn:JSONPath(?msg, "$.country") AS ?countryCode)
    BIND(uri(concat("http://example.org/", ?first, "_", ?last)) AS ?p)
  }
SELECTOR rqg-sel:JSONPath(?msg, "$.[*]") AS ?msg
